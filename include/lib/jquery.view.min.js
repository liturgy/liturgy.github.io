(function($,context,undefined){var jquery_available="fn" in $&&"jquery" in $.fn;if(jquery_available&&Number($.fn.jquery.replace(/\./g))<143){throw"jQuery View requires jQuery 1.4.3 or later."}$.view=function view(structure,methods){if(structure==="engine"){if(typeof(methods)==="string"){default_engine=methods}else{engines[methods.name]=methods;default_engine=methods.name}return}var parent_class=false;if(is_view_class(structure)){parent_class=structure;if(arguments.length==2&&typeof(arguments[1])==="object"){methods=arguments[1];if("initialize" in methods){structure=methods.initialize;delete methods.initialize}else{structure=function(){}}}else{structure=arguments[1];methods=arguments[2]}}else{if(methods===undefined&&typeof(structure)==="object"){if(!("initialize" in structure)){throw'"initialize" method must be specified to create a $.view class.'}else{methods=structure;structure=methods.initialize;delete methods.initialize}}}if(typeof(structure)=="string"){var html=String(structure);structure=function(){return html}}var klass=function klass(attributes){this.length=0;this._element=null;this._delegates=[];this._observers={};this._attributes={};this._changes={};if(is_jquery_object(attributes)){attributes=attributes[0]}if(attributes&&typeof(attributes)==="object"&&attributes.nodeType===1){this.element(attributes);attributes=arguments[1]||{}}this.attributes(attributes||{});if(this.template){this.element(this.template)}for(var i=0;i<this.constructor._methodsToProxy.length;++i){this[this.constructor._methodsToProxy[i]]=proxy(this[this.constructor._methodsToProxy[i]],this)}if($.view.logging){console.log("jQuery.View: initialized ",this," with attributes:",attributes)}var response=this.initialize(this.element());if(response&&!this._element){this.element(response)}if(jquery_available&&(!this._element||!this._element.nodeType||this._element.nodeType!==1)){throw"The view constructor must return either a DOM element or jQuery object, or call this.element() with a DOM element. View constructor returned:"+typeof(this._element)}this.trigger("initialized");if(klass._observers&&"ready" in klass._observers){trigger_or_delay_ready_event_on_instance(this)}};klass._methodsToProxy=[];for(var method_name in methods){klass._methodsToProxy.push(method_name)}klass._observers={};klass._instance=false;extend(klass,$.view.classMethods);if(parent_class){extend(klass.prototype,parent_class.prototype);klass.prototype.initialize=wrap_function(parent_class.prototype.initialize,function(proceed){var parent_element=proxy(proceed,this)()||this.element();var child_element=structure.apply(this,[parent_element])||this.element();return child_element||parent_element});for(var i=0;i<parent_class._methodsToProxy.length;++i){klass._methodsToProxy.push(parent_class._methodsToProxy[i])}}else{extend(klass.prototype,$.view.fn);klass.prototype.initialize=structure}klass.prototype.bind=wrap_function(klass.prototype.bind,observe_wrapper_for_ready_event_on_instance);if(parent_class){klass._observers={};for(var observer_name in parent_class._observers){klass._observers[observer_name]=parent_class._observers[observer_name]}klass.prototype._observers={};wrap_event_methods_for_child_class(klass,parent_class)}extend(klass.prototype,methods||{});return klass};$.view.classMethods={instance:function instance(instance){if(instance===undefined){if(!this._instance){this._instance=new this()}}else{this._instance=instance}return this._instance},bind:function bind(event_name,observer,context){if(typeof(event_name)==="object"){var response={};for(var _event_name in event_name){response[_event_name]=this.bind(_event_name,event_name[_event_name])}return response}else{var arguments_array=array_from(arguments);if(arguments_array[2]===undefined){arguments_array[2]=this}observer=proxy.apply($.view,[observer].concat(arguments_array.slice(2)));if(typeof(event_name)==="string"&&observer!==undefined){if(!(event_name in this._observers)){this._observers[event_name]=[]}this._observers[event_name].push(observer)}return observer}},unbind:function unbind(event_name,observer){if(!(event_name in this._observers)){this._observers[event_name]=[]}if(event_name&&observer){this._observers[event_name]=array_without_value(this._observers[event_name],observer)}else{if(event_name){this._observers[event_name]=[]}else{this._observers={}}}},one:function one(event_name,outer_observer,context){var arguments_array=array_from(arguments);if(arguments_array[2]===undefined){arguments_array[2]=this}outer_observer=proxy.apply($.view,[outer_observer].concat(arguments_array.slice(2)));var inner_observer=proxy(function bound_inner_observer(){var response=outer_observer.apply(this,arguments);this.unbind(event_name,inner_observer);return response},this);if(!(event_name in this._observers)){this._observers[event_name]=[]}this._observers[event_name].push(inner_observer);return inner_observer},trigger:function trigger(event_name){if(!this._observers||!this._observers[event_name]||(this._observers[event_name]&&this._observers[event_name].length==0)){return[]}if(!(event_name in this._observers)){this._observers[event_name]=[]}var collected_return_values=[];var args=array_from(arguments).slice(1);for(var i=0;i<this._observers[event_name].length;++i){var response=this._observers[event_name][i].apply(this._observers[event_name][i],args);if(response===false){return false}else{collected_return_values.push(response)}}return collected_return_values},ready:function ready(){var args=array_from(arguments);args.unshift("ready");return this.bind.apply(this,args)},engine:function engine(engine){if(engine===undefined){return engines[this._engine===undefined?default_engine:this._engine]}else{this._engine=engine}}};$.view.fn={element:function element(element){if(element===undefined){return this._element}else{if(typeof(element)==="function"){element=element.apply(this,[])}if(is_template(this,element)){element=this.render(element)}if(is_html(element)){element=elements_from_html_string(element)[0]}else{if(is_jquery_object(element)){element=element[0]}}this._element=element;this.length=1;this[0]=this._element;if(this._delegates.length>0){for(var i=0;i<this._delegates.length;++i){this.delegate(this._delegates[i][0],this._delegates[i][1],this._delegates[i][2])}this._delegates=[]}if(jquery_available){this.$=generate_selector_delegate(this)}return this._element}},attributes:function attributes(attributes,supress_observers){if(attributes!==undefined){var keys_to_unset={};for(var key in this._attributes){keys_to_unset[key]=true}for(var key in attributes){delete keys_to_unset[key];this.set(key,attributes[key],true)}for(var key in keys_to_unset){this._changes[key]=null;delete this._attributes[keys_to_unset[key]]}if(supress_observers===undefined){this.trigger("change",this._changes,this)}this._changes={};return this._attributes}else{return this._attributes}},get:function get(key){if(arguments.length>1||is_array(key)){var response=[];var args_array;if(is_array(key)){args_array=key}else{args_array=array_from(arguments)}for(var i=0;i<args_array.length;++i){response.push(this.get(args_array[i]))}return response}else{if(typeof(key)==="string"||typeof(key)=="number"){return this._attributes[key]}}},set:function set(key,value,supress_observers){if(typeof(key)==="object"){var attributes=arguments[0];supress_observers=arguments[1];for(var key in attributes){var value=attributes[key];this._attributes[key]=value;this._changes[key]=value}if(supress_observers===undefined){this.trigger("change",this._changes);for(var key in this._changes){this.trigger("change:"+key,this._changes[key])}this._changes={}}return attributes}else{this._attributes[key]=value;this._changes[key]=value;if(supress_observers===undefined){this.trigger("change:"+key,value);this.trigger("change",this._changes);this._changes={}}return value}},bind:$.view.classMethods.bind,unbind:$.view.classMethods.unbind,one:$.view.classMethods.one,trigger:function trigger(event_name){if((!this.constructor._observers||!this.constructor._observers[event_name]||(this.constructor._observers[event_name]&&this.constructor._observers[event_name].length==0))&&(!this._observers||!this._observers[event_name]||(this._observers[event_name]&&this._observers[event_name].length==0))){return[]}var args=array_from(arguments).slice(1);var collected_return_values=[];constructor_args=array_from(arguments).slice(1);constructor_args.unshift(this);constructor_args.unshift(event_name);var collected_return_values_from_constructor=this.constructor.trigger.apply(this.constructor,constructor_args);if(collected_return_values_from_constructor===false){return false}collected_return_values=collected_return_values.concat(collected_return_values_from_constructor);if(!(event_name in this._observers)){this._observers[event_name]=[]}var response;for(var i=0;i<this._observers[event_name].length;++i){response=this._observers[event_name][i].apply(this._observers[event_name][i],args);if(response===false){return false}else{collected_return_values.push(response)}}return collected_return_values},ready:$.view.classMethods.ready,emit:function emit(){var args=array_from(arguments);var context=this;return function emitter(){return context.trigger.apply(context,args)}},map:function map(object,callback,response){response=response||[];if(typeof(object)==="string"){object=this.get(object)}if(is_array(object)){for(var i=0;i<object.length;++i){response.push(callback.apply(this,[object[i],i]))}}else{var i=0;for(var key in object){if(typeof(object[key])==="function"){this.map(this.get(key),object[key],response)}else{response.push(callback.apply(this,[key,object[key],i]))}++i}}return response},callback:function callback(method){var args=array_from(arguments).slice(1);var context=this;return function generated_callback(){if(typeof(method)==="string"){context[method].apply(context,args)}else{method.apply(context,args)}return false}},delegate:function delegate(selector,event_name,callback,context){if(context){callback=proxy(callback,context)}if(this._element){$(this._element).delegate(selector,event_name,callback)}else{this._delegates.push([selector,event_name,callback])}},escape:function escape(string){return document.createTextNode(string)},render:function render(template,attributes){var final_attributes={};for(var key in this){if(in_array(key,["_delegates","_observers","_attributes","_changes"])==-1){final_attributes[key]=this[key]}}extend(final_attributes,this.attributes());extend(final_attributes,attributes);return this.constructor.engine().render(template,final_attributes)}};$.view.logging=false;var engines={};var default_engine;$.view("engine",{name:"jquery.tmpl",detect:function(string){return string.match(/\$\{[^\}]+\}/)},render:function(string,attributes){return $.tmpl(string,attributes)}});function generate_selector_delegate(view){return extend(function generated_selector_delegate(selector){return $(selector,view._element)},$(view._element))}function wrap_event_methods_for_child_class(child_class,parent_class){var methods=["bind","unbind","one"];for(var i=0;i<methods.length;++i){(function method_wrapper_iterator(method_name){parent_class[method_name]=wrap_function(parent_class[method_name],function method_wrapper(proceed){var arguments_array=array_from(arguments).slice(1);child_class[method_name].apply(child_class,arguments_array);return proceed.apply(proceed,arguments_array)})})(methods[i])}}function observe_wrapper_for_ready_event_on_instance(proceed,event_name){var arguments_array=array_from(arguments).slice(1);var response=proceed.apply(proceed,arguments_array);if(event_name=="ready"){trigger_or_delay_ready_event_on_instance(this)}return response}function trigger_or_delay_ready_event_on_instance(instance){if(!instance._readyEventFired&&instance._element&&node_in_dom_tree(instance._element)){instance.trigger("ready");instance._readyEventFired=true;if(instance._readyEventInterval){clearInterval(instance._readyEventInterval)}}else{if(!("_readyEventInterval" in instance)){setTimeout(function(){if(instance._element&&node_in_dom_tree(instance._element)){instance.trigger("ready");instance._readyEventFired=true}else{if(!instance._readyEventInterval){instance._readyEventInterval=setInterval(function(){try{if(instance._element&&node_in_dom_tree(instance._element)){instance.trigger("ready");instance._readyEventFired=true;clearInterval(instance._readyEventInterval);instance._readyEventInterval=false}}catch(e){clearInterval(instance._readyEventInterval);throw e}},10)}}})}}}var methods={};var cache={};var supported_html_tags=("a abbr acronym address applet area b base basefont bdo big blockquote body br button canvas caption center cite code col colgroup dd del dfn dir div dl dt em embed fieldset font form frame frameset h1 h2 h3 h4 h5 h6 head hr html i iframe img input ins isindex kbd label legend li link menu meta nobr noframes noscript object ol optgroup option p param pre q s samp script select small span strike strong style sub sup table tbody td textarea tfoot th thead title tr tt u ul var article aside audio command details figcaption figure footer header hgroup keygen mark meter nav output progress rp ruby section source summary time video").split(/\s+/);var attribute_map={htmlFor:"for",className:"class"};function process_node_argument(view,elements,attributes,argument){if(argument===undefined||argument===null||argument===false){return}if(typeof(argument)==="function"&&!is_view_class(argument)){argument=argument()}if(is_view_instance(argument)||typeof(argument.element)=="function"){elements.push(argument.element());return}else{if(is_view_class(argument)){elements.push(new argument().element());return}}if(typeof(argument)==="function"){argument=argument()}if(typeof(argument)!=="string"&&typeof(argument)!=="number"&&!is_array(argument)&&!is_jquery_object(argument)&&!(argument&&(argument.nodeType===1||argument.nodeType===3))){for(attribute_name in argument){attributes[attribute_name]=argument[attribute_name]}return}if(is_template(view,argument)){argument=view.render(argument)}if(is_jquery_object(argument)){argument=argument.toArray()}if(is_array(argument)){var flattened=flatten_array(argument);for(var i=0;i<flattened.length;++i){process_node_argument(view,elements,attributes,flattened[i])}return}if(is_html(argument)){var generated_elements=elements_from_html_string(argument);for(var i=0;i<generated_elements.length;++i){elements.push(generated_elements[i])}return}else{if((argument&&(argument.nodeType===1||argument.nodeType===3))||typeof(argument)==="string"||typeof(argument)==="number"){elements.push(argument);return}}}function create_element(tag_name){var i,argument,attributes,attribute_name,elements,element;elements=[];attributes={};for(i=1;i<arguments.length;++i){process_node_argument(this,elements,attributes,arguments[i])}tag_name=tag_name.toLowerCase();if(jquery_available){if(!!(document.attachEvent&&!context.opera)&&(attributes.name||(tag_name=="input"&&attributes.type))){tag="<"+tag_name;if(attributes.name){tag+=' name="'+attributes.name+'"'}if(tag_name=="input"&&attributes.type){tag+=' type="'+attributes.type+'"'}tag+=">";delete attributes.name;delete attributes.type;element=document.createElement(tag)}else{if(!cache[tag_name]){cache[tag_name]=document.createElement(tag_name)}element=cache[tag_name].cloneNode(false)}$(element).attr(attributes);for(i=0;i<elements.length;++i){if(elements[i]&&(elements[i].nodeType===1||elements[i].nodeType===3)){element.appendChild(elements[i])}else{element.appendChild(document.createTextNode(String(elements[i])))}}}else{element="<"+tag_name;for(var attribute_name in attributes){element+=" "+(attribute_map[attribute_name]||attribute_name)+'="'+attributes[attribute_name]+'"'}if(elements.length==0){element+=" />"}else{element+=">";for(i=0;i<elements.length;++i){element+=elements[i]}element+="</"+tag_name+">"}}return element}function elements_from_html_string(html){if(jquery_available){var div=create_element("div");div.innerHTML=html;return array_from(div.childNodes)}else{return[html]}}function flatten_array(array){var flattened=[];for(var i=0;i<array.length;++i){if(is_array(array[i])){flattened=flattened.concat(flatten_array(array[i]))}else{flattened.push(array[i])}}return flattened}function generate_builder_method(tag_name){return function element_generator(){var args=[tag_name];for(var i=0;i<arguments.length;++i){args.push(arguments[i])}return create_element.apply(this,args)}}function export_tag_methods(target){for(var method_name in methods){if(!(method_name in target)){target[method_name]=methods[method_name]}}}function remove_tag_methods(target){for(var method_name in methods){delete target[method_name]}}for(var i=0;i<supported_html_tags.length;++i){methods[supported_html_tags[i]]=generate_builder_method(supported_html_tags[i])}export_tag_methods($.view);export_tag_methods($.view.fn);function extend(destination,source){for(var property in source){destination[property]=source[property]}return destination}function is_view_instance(object){return object&&object.element&&object.element().nodeType==1&&object._attributes}function is_view_class(object){return object&&object.prototype&&object.prototype.initialize&&object.prototype.element}function is_jquery_object(object){return object&&typeof(object)=="object"&&("jquery" in object)&&("length" in object)}function is_html(string){return typeof(string)=="string"&&string.match(/^<[\w\W]+>/)}function is_template(view,string){if(typeof(string)!="string"||!view||!("constructor" in view&&"engine" in view.constructor)){return false}return view.constructor.engine().detect(string)}function is_array(array){return Object.prototype.toString.call(array)==="[object Array]"}function in_array(element,array){if(array.indexOf){return array.indexOf(element)}for(var i=0,length=array.length;i<length;i++){if(array[i]===element){return i}}return -1}function array_from(object){if(!object){return[]}var length=object.length||0;var results=new Array(length);while(length--){results[length]=object[length]}return results}function array_without_value(arr){var values=array_from(arguments).slice(1);var response=[];for(var i=0;i<arr.length;i++){if(!(in_array(arr[i],values)>-1)){response.push(arr[i])}}return response}function proxy(func,object){if(object===undefined){return func}if(arguments.length<3){return function bound(){return func.apply(object,arguments)}}else{var args=array_from(arguments);args.shift();args.shift();return function bound(){return func.apply(object,args.concat(array_from(arguments)))}}}function wrap_function(func,wrapper){return function wrapped(){return wrapper.apply(this,[proxy(func,this)].concat(array_from(arguments)))}}function node_in_dom_tree(node){var ancestor=node;while(ancestor.parentNode){ancestor=ancestor.parentNode}return !!(ancestor.body)}if(typeof(module)!=="undefined"){module.exports.render=function render(str,options){return new $.view(new Function(str),options).element()}}})("jQuery" in this?jQuery:("Zepto" in this?Zepto:this),this);