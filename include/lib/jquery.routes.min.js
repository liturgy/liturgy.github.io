(function($,context){if(Number($.fn.jquery.replace(/\./g))<143){throw"jQuery Routes requires jQuery 1.4.3 or later."}$.routes=function(_routes,lazy_loading){if(typeof($.address)=="undefined"){throw"jQuery Address (http://www.asual.com/jquery/address/) is required to run jQuery View Routes"}if(typeof(_routes)=="function"){$.address.bind("externalChange",function(){routes(window.location.href.match("#")?window.location.href.split("#").pop():"")})}else{if(_routes===false){$($.address).unbind("externalChange")}else{if(typeof(_routes)=="string"){var method_name=_routes;if(method_name=="start"){return start()}if(method_name=="stop"){return stop()}if(method_name=="match"){return match(arguments[1])}if(method_name=="set"){return set(arguments[1])}if(method_name=="get"){return get()}if(method_name=="url"){return url(arguments[1],arguments[2])}if(method_name=="setup"){return url(arguments[1])}if(method_name=="add"){return url(arguments[1],arguments[2])}throw method_name+" is not a supported method."}else{for(var key in _routes){if(typeof(_routes[key])==="string"&&!_routes[key].match(/(\#|\.)/)){_routes[key]+="#set"}}set_routes(_routes);if(!lazy_loading){for(var i=0;i<routes.length;++i){setup(routes[i][1],i)}}}}}};function url(class_and_method,params){for(var i=0;i<routes.length;++i){if(routes[i][1]==class_and_method){return generate_url(routes[i][0],params)}}return false}function get(){var path_bits=window.location.href.split("#");return path_bits[1]&&(path_bits[1].match(/^\//)||path_bits[1]=="")?path_bits[1]:""}function set(path,force){var matched_path=match(path);var should_dispatch=path!=current_route;if(!should_dispatch&&force==true){should_dispatch=true}if(enabled&&should_dispatch&&matched_path){matched_path[0]=setup(matched_path[0],matched_path[2]);if(!("callOriginal" in matched_path[0])){set_address(path)}$.routes.history.push([path,matched_path[0],matched_path[1]]);$.routes.dispatcher(matched_path[0],matched_path[1],path);return true}else{return false}}function add(path,callback){routes.push([path,callback]);route_patterns.push(route_matcher_regex_from_path(path))}function match(path){for(var i=0;i<routes.length;++i){if(routes[i][0]==path){return[setup(routes[i][1],i),{},i]}}for(var i=0;i<route_patterns.length;++i){var matches=route_patterns[i][0].exec(path);if(matches){var params={};for(var ii=0;ii<route_patterns[i][1].length;++ii){params[route_patterns[i][1][ii]]=matches[((ii+1)*3)-1]}return[setup(routes[i][1],i),params,i]}}return false}function setup(callback,index_of_route){if(typeof(callback)=="string"&&typeof(index_of_route)=="undefined"){for(var i=0;i<routes.length;++i){if(routes[i][1]==callback){index_of_route=i;break}}throw"Method "+callback+" not found in specified routes."}if(typeof(callback)=="function"){return callback}var path=routes[index_of_route][0];var method_name=callback.match(/\#(.+)$/);if(!method_name){method_name="set"}else{method_name=method_name[1]}var object_name_bits=callback.replace(/\#.+$/,"").split(".");var object=context[object_name_bits[0]];for(var i=1;i<object_name_bits.length;++i){object=object[object_name_bits[i]]}if(typeof(object)==="undefined"){throw'Could not find the object "'+object_name_bits.join(".")+'"'}object=object.instance();if(typeof(object[method_name])==="undefined"){throw'The method "'+method_name+'" does not exist for the route "'+path+'"'}if("callOriginal" in object[method_name]){return object[method_name]}var original_method=object[method_name];object[method_name]=function routing_wrapper(params){set_address(generate_url(path,params));original_method.apply(object,arguments)};object[method_name].callOriginal=function original_method_callback(){return original_method.apply(object,arguments)};return object[method_name]}function stop(){enabled=false}function start(){if(!start_observer&&!ready){start_observer=$(document).ready(function document_ready_observer(){$.address.bind("externalChange",external_change_handler);ready=true;enabled=true;if(!set(get(),true)){set("/")}})}else{ready=true;enabled=true}}$.routes.dispatcher=function dispatcher(callback,params,path){callback(params)};$.routes.history=[];var start_observer=false;var ready=false;var routes=[];var route_patterns=[];var current_route=false;var enabled=false;function set_routes(routes){for(var path in routes){add(path,routes[path])}start()}function route_matcher_regex_from_path(path){var params=[];var reg_exp_pattern=String(path);reg_exp_pattern=reg_exp_pattern.replace(/\((\:?[\w]+)\)/g,function(){return""+arguments[1]+"?"});reg_exp_pattern=reg_exp_pattern.replace(/\:([\w]+)(\/?)/g,function(){params.push(arguments[1]);return"(([\\w]+)(/|$))"});reg_exp_pattern=reg_exp_pattern.replace(/\)\?\/\(/g,")?(");if(reg_exp_pattern.match(/\*/)){params.push("path");reg_exp_pattern=reg_exp_pattern.replace(/\*/g,"((.+$))?")}return[new RegExp("^"+reg_exp_pattern+"$"),params]}function generate_url(url,params){params=params||{};if(typeof(params)=="string"&&url.match(/\*/)){url=url.replace(/\*/,params).replace(/\/\//g,"/")}else{if(params.path){url=url.replace(/\*/,params.path.replace(/^\//,""))}var param_matcher=new RegExp("(\\()?\\:([\\w]+)(\\))?(/|$)","g");for(var param_name in params){if(param_name!="path"){url=url.replace(param_matcher,function(){return arguments[2]==param_name?params[param_name]+arguments[4]:(arguments[1]||"")+":"+arguments[2]+(arguments[3]||"")+arguments[4]})}}}url=url.replace(/\([^\)]+\)/g,"");return url}function set_address(path){if(enabled){if(current_route!=path){$.address.value(path);current_route=path}}}function external_change_handler(){if(enabled){var current_path=get();if(ready){if(current_path!=current_route){set(current_path)}}}}})(jQuery,this);