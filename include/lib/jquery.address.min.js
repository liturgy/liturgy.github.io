!function(t){t.address=function(){var e,r,n=function(e){var r=t.extend(t.Event(e),function(){for(var e={},r=t.address.parameterNames(),n=0,a=r.length;a>n;n++)e[r[n]]=t.address.parameter(r[n]);return{value:t.address.value(),path:t.address.path(),pathNames:t.address.pathNames(),parameterNames:r,parameters:e,queryString:t.address.queryString()}}.call(t.address));return t(t.address).trigger(r),r},a=function(t){return Array.prototype.slice.call(t)},i=function(){return t().bind.apply(t(t.address),Array.prototype.slice.call(arguments)),t.address},s=function(){return t().unbind.apply(t(t.address),Array.prototype.slice.call(arguments)),t.address},o=function(){return D.pushState&&F.state!==e},c=function(){return("/"+K.pathname.replace(new RegExp(F.state),"")+K.search+(u()?"#"+u():"")).replace(H,"/")},u=function(){var t=K.href.indexOf("#");return-1!=t?f(K.href.substr(t+1),C):""},l=function(){return o()?c():u()},d=function(){try{return top.document!==e&&top.document.title!==e?top:window}catch(t){return window}},p=function(){return"javascript"},h=function(t){return t=t.toString(),(F.strict&&"/"!=t.substr(0,1)?"/":"")+t},f=function(t,e){return F.crawlable&&e?(""!==t?"!":"")+t:t.replace(/^\!/,"")},g=function(t,e){return parseInt(t.css(e),10)},v=function(){if(!te){var t=l(),e=decodeURI(ae)!=decodeURI(t);e&&(W&&7>M?K.reload():(W&&!V&&F.history&&G(b,50),_old=ae,ae=t,m(C)))}},m=function(t){var e=n(A),r=n(t?N:O);G(w,10),(e.isDefaultPrevented()||r.isDefaultPrevented())&&y()},y=function(){ae=_old,o()?D.popState({},"",F.state.replace(/\/$/,"")+(""===ae?"/":ae)):(te=T,z?F.history?K.hash="#"+f(ae,T):K.replace("#"+f(ae,T)):ae!=l()&&(F.history?K.hash="#"+f(ae,T):K.replace("#"+f(ae,T))),W&&!V&&F.history&&G(b,50),z?G(function(){te=C},1):te=C)},w=function(){if("null"!==F.tracker&&F.tracker!==I){var r=t.isFunction(F.tracker)?F.tracker:B[F.tracker],n=(K.pathname+K.search+(t.address&&!o()?t.address.value():"")).replace(/\/\//,"/").replace(/^\/$/,"");t.isFunction(r)?r(n):t.isFunction(B.urchinTracker)?B.urchinTracker(n):B.pageTracker!==e&&t.isFunction(B.pageTracker._trackPageview)?B.pageTracker._trackPageview(n):B._gaq!==e&&t.isFunction(B._gaq.push)&&B._gaq.push(["_trackPageview",decodeURI(n)])}},b=function(){var t=p()+":"+C+";document.open();document.writeln('<html><head><title>"+P.title.replace(/\'/g,"\\'")+"</title><script>var "+U+' = "'+encodeURIComponent(l()).replace(/\'/g,"\\'")+(P.domain!=K.hostname?'";document.domain="'+P.domain:"")+"\";</script></head></html>');document.close();";7>M?r.src=t:r.contentWindow.location.replace(t)},x=function(){if(X&&-1!=Y){var t,e,r=X.substr(Y+1).split("&");for(t=0;t<r.length;t++)e=r[t].split("="),/^(autoUpdate|crawlable|history|strict|wrap)$/.test(e[0])&&(F[e[0]]=isNaN(e[1])?/^(true|yes)$/i.test(e[1]):0!==parseInt(e[1],10)),/^(state|tracker)$/.test(e[0])&&(F[e[0]]=e[1]);X=I}_old=ae,ae=l()},k=function(){if(!ee){ee=T,x();var a=function(){E.call(this),_.call(this)},i=t("body").ajaxComplete(a);if(a(),F.wrap){{t("body > *").wrapAll('<div style="padding:'+(g(i,"marginTop")+g(i,"paddingTop"))+"px "+(g(i,"marginRight")+g(i,"paddingRight"))+"px "+(g(i,"marginBottom")+g(i,"paddingBottom"))+"px "+(g(i,"marginLeft")+g(i,"paddingLeft"))+'px;" />').parent().wrap('<div id="'+U+'" style="height:100%;overflow:auto;position:relative;'+(z&&!window.statusbar.visible?"resize:both;":"")+'" />')}t("html, body").css({height:"100%",margin:0,padding:0,overflow:"hidden"}),z&&t('<style type="text/css" />').appendTo("head").text("#"+U+"::-webkit-resizer { background-color: #fff; }")}if(W&&!V){var s=P.getElementsByTagName("frameset")[0];r=P.createElement((s?"":"i")+"frame"),r.src=p()+":"+C,s?(s.insertAdjacentElement("beforeEnd",r),s[s.cols?"cols":"rows"]+=",0",r.noResize=T,r.frameBorder=r.frameSpacing=0):(r.style.display="none",r.style.width=r.style.height=0,r.tabIndex=-1,P.body.insertAdjacentElement("afterBegin",r)),G(function(){t(r).bind("load",function(){var t=r.contentWindow;_old=ae,ae=t[U]!==e?t[U]:"",ae!=l()&&(m(C),K.hash=f(ae,T))}),r.contentWindow[U]===e&&b()},50)}G(function(){n("init"),m(C)},1),o()||(W&&M>7||!W&&V?B.addEventListener?B.addEventListener(j,v,C):B.attachEvent&&B.attachEvent("on"+j,v):Q(v,50)),"state"in window.history&&t(window).trigger("popstate")}},E=function(){var e,r=t("a"),n=r.size(),a=1,i=-1,s='[rel*="address:"]',o=function(){++i!=n&&(e=t(r.get(i)),e.is(s)&&e.address(s),G(o,a))};G(o,a)},S=function(){decodeURI(ae)!=decodeURI(l())&&(_old=ae,ae=l(),m(C))},R=function(){B.removeEventListener?B.removeEventListener(j,v,C):B.detachEvent&&B.detachEvent("on"+j,v)},_=function(){if(F.crawlable){var e=K.pathname.replace(/\/$/,""),r="_escaped_fragment_";-1!=t("body").html().indexOf(r)&&t('a[href]:not([href^=http]), a[href*="'+document.domain+'"]').each(function(){var n=t(this).attr("href").replace(/^http:/,"").replace(new RegExp(e+"/?$"),"");(""===n||-1!=n.indexOf(r))&&t(this).attr("href","#"+encodeURI(decodeURIComponent(n.replace(new RegExp("/(.*)\\?"+r+"=(.*)$"),"!$2"))))})}},I=null,U="jQueryAddress",$="string",j="hashchange",q="init",A="change",N="internalChange",O="externalChange",T=!0,C=!1,F={autoUpdate:T,crawlable:C,history:T,strict:T,wrap:C},L=t.browser,M=parseFloat(L.version),W=!t.support.opacity,z=L.webkit||L.safari,B=d(),P=B.document,D=B.history,K=B.location,Q=setInterval,G=setTimeout,H=/\/{2,9}/g,J=navigator.userAgent,V="on"+j in B,X=t("script:last").attr("src"),Y=X?X.indexOf("?"):-1,Z=P.title,te=C,ee=C,re=T,ne=C,ae=l();if(_old=ae,W){M=parseFloat(J.substr(J.indexOf("MSIE")+4)),P.documentMode&&P.documentMode!=M&&(M=8!=P.documentMode?7:8);var ie=P.onpropertychange;P.onpropertychange=function(){ie&&ie.call(P),P.title!=Z&&-1!=P.title.indexOf("#"+l())&&(P.title=Z)}}if(D.navigationMode&&(D.navigationMode="compatible"),"complete"==document.readyState)var se=setInterval(function(){t.address&&(k(),clearInterval(se))},50);else x(),t(k);return t(window).bind("popstate",S).bind("unload",R),{bind:function(){return i.apply(this,a(arguments))},unbind:function(){return s.apply(this,a(arguments))},init:function(){return i.apply(this,[q].concat(a(arguments)))},change:function(){return i.apply(this,[A].concat(a(arguments)))},internalChange:function(){return i.apply(this,[N].concat(a(arguments)))},externalChange:function(){return i.apply(this,[O].concat(a(arguments)))},baseURL:function(){var t=K.href;return-1!=t.indexOf("#")&&(t=t.substr(0,t.indexOf("#"))),/\/$/.test(t)&&(t=t.substr(0,t.length-1)),t},autoUpdate:function(t){return t!==e?(F.autoUpdate=t,this):F.autoUpdate},crawlable:function(t){return t!==e?(F.crawlable=t,this):F.crawlable},history:function(t){return t!==e?(F.history=t,this):F.history},state:function(t){if(t!==e){F.state=t;var r=c();return F.state!==e&&(D.pushState?"/#/"==r.substr(0,3)&&K.replace(F.state.replace(/^\/$/,"")+r.substr(2)):"/"!=r&&r.replace(/^\/#/,"")!=u()&&G(function(){K.replace(F.state.replace(/^\/$/,"")+"/#"+r)},1)),this}return F.state},strict:function(t){return t!==e?(F.strict=t,this):F.strict},tracker:function(t){return t!==e?(F.tracker=t,this):F.tracker},wrap:function(t){return t!==e?(F.wrap=t,this):F.wrap},update:function(){return ne=T,this.value(ae),ne=C,this},title:function(t){return t!==e?(G(function(){Z=P.title=t,re&&r&&r.contentWindow&&r.contentWindow.document&&(r.contentWindow.document.title=t,re=C)},50),this):P.title},value:function(t){if(t!==e){if(t=h(t),"/"==t&&(t=""),ae==t&&!ne)return;return _old=ae,ae=t,(F.autoUpdate||ne)&&(m(T),o()?D[F.history?"pushState":"replaceState"]({},"",F.state.replace(/\/$/,"")+(""===ae?"/":ae)):(te=T,z?F.history?K.hash="#"+f(ae,T):K.replace("#"+f(ae,T)):ae!=l()&&(F.history?K.hash="#"+f(ae,T):K.replace("#"+f(ae,T))),W&&!V&&F.history&&G(b,50),z?G(function(){te=C},1):te=C)),this}return h(ae)},path:function(t){if(t!==e){var r=this.queryString(),n=this.hash();return this.value(t+(r?"?"+r:"")+(n?"#"+n:"")),this}return h(ae).split("#")[0].split("?")[0]},pathNames:function(){var t=this.path(),e=t.replace(H,"/").split("/");return("/"==t.substr(0,1)||0===t.length)&&e.splice(0,1),"/"==t.substr(t.length-1,1)&&e.splice(e.length-1,1),e},queryString:function(t){if(t!==e){var r=this.hash();return this.value(this.path()+(t?"?"+t:"")+(r?"#"+r:"")),this}var n=ae.split("?");return n.slice(1,n.length).join("?").split("#")[0]},parameter:function(r,n,a){var i,s;if(n!==e){var o=this.parameterNames();for(s=[],n=n===e||n===I?"":n.toString(),i=0;i<o.length;i++){var c=o[i],u=this.parameter(c);typeof u==$&&(u=[u]),c==r&&(u=n===I||""===n?[]:a?u.concat([n]):[n]);for(var l=0;l<u.length;l++)s.push(c+"="+u[l])}return-1==t.inArray(r,o)&&n!==I&&""!==n&&s.push(r+"="+n),this.queryString(s.join("&")),this}if(n=this.queryString()){var d=[];for(s=n.split("&"),i=0;i<s.length;i++){var p=s[i].split("=");p[0]==r&&d.push(p.slice(1).join("="))}if(0!==d.length)return 1!=d.length?d:d[0]}},parameterNames:function(){var e=this.queryString(),r=[];if(e&&-1!=e.indexOf("="))for(var n=e.split("&"),a=0;a<n.length;a++){var i=n[a].split("=")[0];-1==t.inArray(i,r)&&r.push(i)}return r},hash:function(t){if(t!==e)return this.value(ae.split("#")[0]+(t?"#"+t:"")),this;var r=ae.split("#");return r.slice(1,r.length).join("#")}}}(),t.fn.address=function(e){var r;if("string"==typeof e&&(r=e,e=void 0),!t(this).attr("address")){var n=function(r){if(r.shiftKey||r.ctrlKey||r.metaKey||2==r.which)return!0;if(t(this).is("a")){r.preventDefault();var n=e?e.call(this):/address:/.test(t(this).attr("rel"))?t(this).attr("rel").split("address:")[1].split(" ")[0]:void 0===t.address.state()||/^\/?$/.test(t.address.state())?t(this).attr("href").replace(/^(#\!?|\.)/,""):t(this).attr("href").replace(new RegExp("^(.*"+t.address.state()+"|\\.)"),"");t.address.value(n)}};t(r?r:this).live("click",n).live("submit",function(r){if(t(this).is("form")){r.preventDefault();var n=t(this).attr("action"),a=e?e.call(this):(-1!=n.indexOf("?")?n.replace(/&$/,""):n+"?")+t(this).serialize();t.address.value(a)}}).attr("address",!0)}return this}}(jQuery);